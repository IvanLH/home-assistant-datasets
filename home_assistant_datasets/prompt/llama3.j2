{% if system or tools %}<|start_header_id|>system<|end_header_id|>
{% if system %}

{{ system }}
{%- endif %}
{%- if tools %}

You are a helpful assistant with tool calling capabilities. When you receive a tool call response, use the output to format an answer to the orginal use question.
{%- endif %}
{%- endif %}<|eot_id|>
{%- for message in messages %}
{%- if message.role == "user" %}<|start_header_id|>user<|end_header_id|>
{%- if tools and loop.last %}

Given the following functions, please respond with a JSON for a function call with its proper arguments that best answers the given prompt.

Respond in the format {"name": function name, "parameters": dictionary of argument name and its value}. Do not use variables.

{{ tools }}
{%- endif %}

{{ message.content }}<|eot_id|>{% if loop.last %}<|start_header_id|>assistant<|end_header_id|>

{% endif %}
{%- elif message.role == "assistant" %}<|start_header_id|>assistant<|end_header_id|>
{%- if tool_calls %}

{% for function in tool_calls: %}{"name": "{{ function.Name }}", "parameters": {{ function.Arguments }}}{% endfor %}
{%- else %}

{{ message.content }}{% if not loop.last %}<|eot_id|>{% endif %}
{%- endif %}
{%- elif message.role == "tool" %}<|start_header_id|>ipython<|end_header_id|>

{{ message.content }}<|eot_id|>{% if loop.last %}<|start_header_id|>assistant<|end_header_id|>

{% endif %}
{%- endif %}
{%- endfor %}
